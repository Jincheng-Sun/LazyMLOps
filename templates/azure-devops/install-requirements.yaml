parameters:
  - name: environment
    type: string
    default: "dev"
  - name: requirements_file
    type: string
    default: "requirements_azureml.txt"
  - name: dev_index_url
    type: string
    default: "https://pypi.org/simple"
  - name: staging_index_url
    type: string
    default: "https://staging-artifactory.example.com"
  - name: prod_index_url
    type: string
    default: "https://prod-artifactory.example.com"

steps:
  - script: |
      
      echo "Install Python dependencies in environment: $ENVIRONMENT"
      echo "Requirements file: $REQUIREMENTS_FILE"

      if [[ "$ENVIRONMENT" == "dev" ]]; then
        export PIP_INDEX_URL="$DEV_INDEX_URL"
      elif [[ "$ENVIRONMENT" == "staging" ]]; then
        export PIP_INDEX_URL="$STAGING_INDEX_URL"
      elif [[ "$ENVIRONMENT" == "prod" ]]; then
        export PIP_INDEX_URL="$PROD_INDEX_URL"
      else
        echo "Unknown environment: $ENVIRONMENT"
        exit 1
      fi
      
      echo "Using PIP index URL: $PIP_INDEX_URL"
      
      pip install --upgrade pip
      pip install --upgrade -r "$(Build.SourcesDirectory)/$REQUIREMENTS_FILE"
    displayName: "Install Python Dependencies"
    env:
      ENVIRONMENT: ${{ parameters.environment }}
      REQUIREMENTS_FILE: ${{ parameters.requirements_file }}
      DEV_INDEX_URL: ${{ parameters.dev_index_url }}
      STAGING_INDEX_URL: ${{ parameters.staging_index_url }}
      PROD_INDEX_URL: ${{ parameters.prod_index_url }}